.. raw:: html

   <!--

   ============================================================================

      DO NOT EDIT THIS FILE! It was generated using Sphinx from:

      Origin:   $URL$
      Revision: $Rev$

   ============================================================================

   -->

.. raw:: latex

    \pagebreak

.. title:: Manual

.. meta::
    :description: The documentation of the LIBRA software, providing user instructions
	on how to run LIBRA to obtain density from Digital Mammograms in DICOM format.


======
Manual
======

.. only:: html

    :download:`LIBRA Manual <LIBRA_Software_Manual.pdf>`: PDF version of this software manual.

---------------------------------------
Running the Software - Interactive Mode
---------------------------------------

When running LIBRA in interactive mode (i.e., by double-clicking the .exe file) the user is first prompted as to whether they would like to analyze a single DICOM image, 
batch process all DICOM images in a specific folder, or exit out of the software. Details on the specific options are provided below.

.. _fig_LIBRA_RunOptions:

    .. figure::   LIBRA_RunOptions.jpg
       :alt:      LIBRA interactive mode: analysis selection.
       :align:    center


Interactive Mode - Single Image
===============================
If the user chooses to analyze a single DICOM image, they are first prompted to select a DICOM image to analyze via a standard dialogue prompt.

.. _fig_LIBRA_SingleImagePrompt:

    .. figure::   LIBRA_SingleImagePrompt.jpg
       :alt:      LIBRA interactive mode: single image analysis prompt.
       :align:    center


.. _fig_LIBRA_SingleImageSelection:

    .. figure::   LIBRA_SingleImageSelection.jpg
       :alt:      LIBRA interactive mode: single image selection.
       :align:    center

	   
Second, the user is then prompted to select an output folder where the density scores and density segmentation image .jpg file will be stored. Note: If the folder already exists and contains density estimates 
(e.g., from a previous run of LIBRA.exe), it will append the new results to the results file.

.. _fig_LIBRA_OutputPrompt:

    .. figure::   LIBRA_OutputPrompt.jpg
       :alt:      LIBRA interactive mode: output prompt.
       :align:    center


.. _fig_LIBRA_OutputSelectionSingle:

    .. figure::   LIBRA_OutputSelectionSingle.jpg
       :alt:      LIBRA interactive mode: output folder selection.
       :align:    center
       

Lastly, the user will be asked whether they wish to store a processing log file and intermediate graphics in addition to the density segmentation outline which may be on interest for publication or visualization purposes, and are further described in the **Outputs** section below.

.. _fig_LIBRA_IntermediateFilesPrompt:

    .. figure::   LIBRA_IntermediateFilesPrompt.jpg
       :alt:      LIBRA interactive mode: store optional/intermediate files prompt.
       :align:    center
       
	   
LIBRA will then begin processing the image; the progress of the software can be monitored via the related command-prompt window that opens when LIBRA.exe is run. The average runtime for most images is 6-10 seconds.
When analysis is complete, a prompt appears asking the user if they want to open the results folder and if they want to perform additional analyses. 

.. _fig_LIBRA_CompletePrompt:

    .. figure::   LIBRA_CompletePrompt.jpg
       :alt:      LIBRA interactive mode: prompt at completion.
       :align:    center

	   
.. _fig_LIBRA_AdditionalAnalyses:

    .. figure::   LIBRA_AdditionalAnalyses.jpg
       :alt:      LIBRA interactive mode: additional analyses prompt.
       :align:    center


Interactive Mode - Batch Process Folder
=======================================
If the user chooses to perform a batch analysis of all the DICOM images within a folder, they are first prompted to select the folder to analyze via a standard dialogue prompt.

.. _fig_LIBRA_BatchPrompt:

    .. figure::   LIBRA_BatchPrompt.jpg
       :alt:      LIBRA interactive mode: batch analysis prompt.
       :align:    center


.. _fig_LIBRA_BatchSelection:

    .. figure::   LIBRA_BatchSelection.jpg
       :alt:      LIBRA interactive mode: folder selection.
       :align:    center

	   
Second, the user is then prompted to select an output folder where the density scores and density segmentation images .jpg files will be stored. Note: If the folder already exists and contains density estimates 
(e.g., from a previous run of LIBRA.exe), it will append the new results to the results file.

.. _fig_LIBRA_OutputPrompt:

    .. figure::   LIBRA_OutputPrompt.jpg
       :alt:      LIBRA interactive mode: output prompt.
       :align:    center


.. _fig_LIBRA_OutputSelectionBatch:

    .. figure::   LIBRA_OutputSelectionBatch.jpg
       :alt:      LIBRA interactive mode: output folder selection.
       :align:    center
       

Lastly, the user will be asked whether they wish to store a processing log file intermediate graphics in addition to the density segmentation outline which may be on interest for publication or visualization purposes,
and are further described in the **Outputs** section below.

.. _fig_LIBRA_IntermediateFilesPrompt:

    .. figure::   LIBRA_IntermediateFilesPrompt.jpg
       :alt:      LIBRA interactive mode: store optional/intermediate files prompt.
       :align:    center

	   
LIBRA will then begin processing all the DICOM images; the progress of the software can be monitored via the related command-prompt window that opens when LIBRA.exe is run. The average runtime for most images is 6-10 seconds.
When analysis is complete, a prompt appears asking the user if they want to open the results folder and if they want to perform additional analyses. 

.. _fig_LIBRA_CompletePrompt:

    .. figure::   LIBRA_CompletePrompt.jpg
       :alt:      LIBRA interactive mode: prompt at completion.
       :align:    center
	   
.. _fig_LIBRA_AdditionalAnalyses:

    .. figure::   LIBRA_AdditionalAnalyses.jpg
       :alt:      LIBRA interactive mode: additional analyses prompt.
       :align:    center

----------------------------------------
Running the Software - Command Line Mode
----------------------------------------
The command-line interface of LIBRA was designed to amenable to batch processing and scripting, so that the user can explicitly define the input and output paths to the files and folders to be analyzed.
To run libra.exe via the command-line, two input arguments are required along with a third, optional argument. The software will then run non-interactively and process the single file specified 
(or all files under the directory provided) by <input>, saving the results to the specified output folder <outDir>. The arguments are:


     input              <char>  Absolute path to the dicom file or directory containing dicom images (Optional)


     outDir             <char>  Absolute path to the output directory (Required if <input> is specified)


     saveIntermediate   <bool>  Boolean value to save the intermediate output (1) or not (0) (Optional; If not specified, default: 0, intermediate files are not saved)

An example command-line would take the form of: libra.exe <input> <outDir> <saveIntermediate>

Note: As in interactive mode, if the output folder already exists and contains density estimates (e.g., from a previous run of LIBRA.exe), it will append the new results to the results file. 
The interactive-mode interface can also be called via the command-line when no arguments are passed to libra.exe. This would be equivalent to double-clicking the libra.exe file.

-------------
LIBRA Outputs
-------------
The LIBRA software generates several forms of output all stored in the output directory specified by the user, including tables containing the density estimates, log-files of the session, and figures for 
presentation and review. **The following outputs are always generated by the software:**

Masks_<Image-Analyzed>.mat: A MATLAB datafile containing a structure array that stores the breast area (res.BreastArea), dense area (res.DenseArea), and area percent density estimates (res.PD_SVM) for the DICOM mammography file analyzed (res.dcm_fname). This structure array also stores the binary masks of the breast (res.BreastMask) and dense tissue segmentations (res.DenseMask), which may be useful for further processing and analysis.

Density.csv: A comma separated file (open-able by spreadsheet programs like Excel) that stores the breast area, dense area, and percent density estimates for each mammogram analyzed, listed by file name. The Manufacturer, Laterality and View-Position of the mammogram are also provided for reference.

.. _fig_Density_csv:

    .. figure::   Density_csv.jpg
       :alt:      Density results table.
       :align:    center
       
       Density.csv
	   
<Image-Analyzed-Filename>_density_segmentation.jpg: In the Result_Images sub-directory, the breast and density segmentation results are provided for each image analyzed. The breast is outlined in red, the density segmentation is in green. Note that for visualization purposes, the image is window-levelled to between the 5th and 95th percentile of the intensity values of the pixels within the breast region.	 

.. _fig_density_segmentation:

    .. figure::   Case5_density_segmentation.jpg
       :alt:      LIBRA example segmentation result.
       :align:    center
       :width:    80%
       :figwidth: 80%

       <Image-Analyzed-Filename>_density_segmentation.jpg
	  
**The following outputs are only generated by the software if the user specifies to save intermediate files:**

LIBRA-logfile_<time-stamp>.txt: A log of the programs outputs during the session, this text file is time-stamped at the start of the LIBRA sessions so that multiple sessions writting to the same output folder each have their own unique log of events. The <time-stamp> takes the form of <Month>-<DD>-<YYYY>_HH-MM-SS, in 24-hour format.
.. _fig_log_file:

    .. figure::   log_file.jpg
       :alt:      LIBRA example log file.
       :align:    center
       
       LIBRA-logfile_<time-stamp>.txt
       
<Image-Analyzed-Filename>_Windowed_Original.jpg: In the Result_Images sub-directory, the analyzed image window-levelled to between the 5th and 95th percentile of the intensity values of the pixels within the breast region is also provided with out the breast density segmentation overlay for comparison purposes.

.. _fig_density_segmentation_no-overlay:

    .. figure::   Case5_Windowed_Original.jpg
       :alt:      LIBRA - original image, window-levelled.
       :align:    center
       :width:    80%
       :figwidth: 80%
       
       <Image-Analyzed-Filename>_Windowed_Original.jpg
	   
<Image-Analyzed>_density_imagesc.jpg: In the Result_Images sub-directory, the image clusters (grouped by colors) generated by the Fuzzy C-Means stage of the LIBRA algorithm is provided.

.. _fig_fcm:

    .. figure::   Case5_density_imagesc.jpg
       :alt:      LIBRA - intermediate FCM results.
       :align:    center
       :width:    80%
       :figwidth: 80%
       
       <Image-Analyzed>_density_imagesc.jpg

<Image-Analyzed>_intensity_histogram.jpg: In the Result_Images sub-directory, the breast intensity histogram (z-scored) and FCM-cluster centers are plotted in this image.
	   
.. _fig_intensity_histogram:

    .. figure::   Case5_intensity_histogram.jpg
       :alt:      LIBRA - FCM cluster centers and image intensity histogram.
       :align:    center
       :width:    80%
       :figwidth: 80%
       
       <Image-Analyzed>_intensity_histogram.jpg

--------------------------------------------
Running the Software - Using the Source code
--------------------------------------------

.. include:: ../README.txt
